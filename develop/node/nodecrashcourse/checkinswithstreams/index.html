<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-company/node/node-crash-course/checkinswithstreams/index-checkinswithstreams">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Processing Checkins with Redis Streams | The Home of ThreeTen Labs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://threetenlabs.com/develop/node/nodecrashcourse/checkinswithstreams"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Processing Checkins with Redis Streams | The Home of ThreeTen Labs"><meta data-rh="true" name="description" content="&lt;iframe"><meta data-rh="true" property="og:description" content="&lt;iframe"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://threetenlabs.com/develop/node/nodecrashcourse/checkinswithstreams"><link data-rh="true" rel="alternate" href="https://threetenlabs.com/develop/node/nodecrashcourse/checkinswithstreams" hreflang="en"><link data-rh="true" rel="alternate" href="https://threetenlabs.com/develop/node/nodecrashcourse/checkinswithstreams" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.2edce49f.css">
<link rel="preload" href="/assets/js/runtime~main.2d5a4e7a.js" as="script">
<link rel="preload" href="/assets/js/main.26486879.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:rgb(210, 215, 254);color:rgb(22 31 49)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><div class="announcement-bar"><a href="https://google.com" target="_blank" rel="noopener"><span>Announcing the first release of Spider Solitaire</span> <span style="margin-left:1rem">Learn more</span> <span style="margin-left:0.25rem">→</span></a></div></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-1.png" alt="ThreeTen Labs logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-1.png" alt="ThreeTen Labs logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div><a class="navbar__item navbar__link" href="/games/">Games</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><main class="docMainContainer_gTbr docMainContainerEnhanced_Uz_u"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Processing Checkins with Redis Streams</h1></header><div class="text--center"><iframe width="896" height="509" src="https://www.youtube.com/embed/19gPDwmXNWc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></div><p>The most common action that users perform with our system is checking in at a location. This part of the system needs to quickly capture checkins and scale independently of other components.</p><p>We decided to build a separate Express application just to receive checkin POST requests from users. This allows us to scale it separately from other API endpoints that deal with GET requests. To make our Checkin Receiver as fast as possible, we decided to do the actual work of processing checkins in a separate service. The Checkin Processor service reads checkins from the stream and updates the user and location Hashes in Redis.</p><p>Checkins are transient data in our system - as long as we process them all, we don&#x27;t need to keep them around forever. It also makes sense to store them in the order that they arrive in the system.</p><p>Using a Redis Stream to store our checkin data is a natural fit for this use case. A Stream acts as a buffer between producer and consumer components. With Redis Streams, each entry in the stream is given a timestamp ID and the Stream is ordered by these IDs.</p><p>In our application, the Checkin Receiver Service is the <em>producer</em> and the Checkin Processor the <em>consumer</em>. We can represent this in a diagram like so:</p><p><img loading="lazy" alt="Streams Overview" src="/assets/images/stream_overview-ee1bf9b1581a559b156ff57f50798881.png" width="3184" height="1730" class="img_ev3q"></p><p>Using a Stream allows these components to operate at different speeds with no knowledge of each other. The Checkin Receiver simply adds a new entry to the Stream for each checkin it receives from a user, and the Checkin Processor reads the Stream and updates user and location Hashes at its own pace.</p><p>It&#x27;s also possible to read a Redis Stream to find entries that were added in a specified time period between a start and end IDs. As our IDs are timestamps, this means that we can request data that was added in a given timeframe. We use this capability in the API Server component and in this module&#x27;s coding exercise you&#x27;ll get to extend this with new functionality.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="hands-on-exercise">Hands-on exercise<a class="hash-link" href="#hands-on-exercise" title="Direct link to heading">​</a></h2><p>Take a moment to run the Checkin Processor component which reads checkins from the stream and updates user and location Hashes.</p><p>The sample data contains 5000 unprocessed checkins which the Checkin Processor will consume. The Checkin Processor keeps track of how far it has gotten in the stream by storing the ID of the last processed checkin in Redis. This way, when it&#x27;s stopped and restarted it picks up from where it left off.</p><p>In a terminal window, <code>cd</code> to the <code>node-js-crash-course</code> folder that you cloned the GitHub repo to, and start the Checkin Processor:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run checkinprocessor delay</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Adding <code>delay</code> introduces an artificial random processing time for each checkin. This slows the Checkin Processor down so that you can examine its output more easily. You should see it start up and begin processing checkins from the start of the stream at ID 0, which is the lowest possible stream entry ID:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run checkinprocessor delay</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> js-crash-course@0.0.1 checkinprocessor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">node</span><span class="token plain"> ./src/checkinprocessor.js -- </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;delay&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">info: Reading stream from last ID </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Updating user ncc:users:789 and location ncc:locations:171.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">info: Processed checkin </span><span class="token number" style="color:rgb(247, 140, 108)">1609602085397</span><span class="token plain">-0.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Updating user ncc:users:455 and location ncc:locations:181.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">info: Processed checkin </span><span class="token number" style="color:rgb(247, 140, 108)">1609603711960</span><span class="token plain">-0.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Updating user ncc:users:752 and location ncc:locations:100.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">info: Processed checkin </span><span class="token number" style="color:rgb(247, 140, 108)">1609604227545</span><span class="token plain">-0.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Updating user ncc:users:102 and location ncc:locations:144.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">info: Processed checkin </span><span class="token number" style="color:rgb(247, 140, 108)">1609604778689</span><span class="token plain">-0.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">debug: Updating user ncc:users:180 and location ncc:locations:13.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">info: Processed checkin </span><span class="token number" style="color:rgb(247, 140, 108)">1609605397408</span><span class="token plain">-0.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Stop the Checkin Processor with Ctrl-C after it has processed a few checkins. Note the ID of the last checkin processed (this is <code>1609605397408-0</code> in the example above). Also note the user and location ID for the last checkin processed (user 180, location 13 in the example above).</p><p>Verify that the Checkin Processor stored this ID in Redis so that it knows where to start from when it&#x27;s restarted. Using redis-cli or RedisInsight, take a look at the contents of the key <code>ncc:checkinprocessor:lastid</code>:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">9</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> get ncc:checkinprocessor:lastid</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1609605397408-0&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The value should match the last checkin ID that was processed.</p><p>Finally, let&#x27;s verify that the Checkin Processor updated the user&#x27;s Hash with details from that checkin. Use RedisInsight or the <code>HGETALL</code> command in redis-cli to look at the hash whose key is <code>ncc:users:&lt;user-id&gt;</code>, replacing <code>&lt;user-id&gt;</code> with the ID of the user that you noted earlier.</p><p>So for my example, let&#x27;s look at user 180:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:637</span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">9</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> hgetall ncc:users:180</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;180&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;firstName&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Sophia&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;lastName&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Marshall&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;email&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;sophia.marshall@example.com&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;password&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$2b</span><span class="token string variable" style="color:rgb(191, 199, 213)">$05</span><span class="token string variable" style="color:rgb(191, 199, 213)">$DPSHjaW44H4fn9sudfz</span><span class="token string" style="color:rgb(195, 232, 141)">/5.f1WcuZMrA0OZIp0CALQf0MH8zH1SSda&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;numCheckins&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;2332&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">13</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;lastCheckin&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">14</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1609605397408&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;lastSeenAt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;13&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Verify that the value for <code>lastCheckin</code> is the timestamp from the last processed checkin&#x27;s ID (<code>1609605397408</code>) in my case, and that the <code>lastSeenAt</code> value is the location ID from the last processed checkin (<code>13</code> in my case).</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="coding-exercise">Coding exercise<a class="hash-link" href="#coding-exercise" title="Direct link to heading">​</a></h2><p>In this exercise, you&#x27;ll implement a new route in the API Server component. This route will return only the most recent checkin from the checkins stream. You&#x27;ll use the <a href="https://redis.io/commands/xrevrange" target="_blank" rel="noopener noreferrer">XREVRANGE command</a> for this.</p><p>First, make sure the API Server is running:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run dev</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(remember that this starts the server with nodemon, so as you modify the code and save your changes it will automatically restart and run the new code).</p><p>Open the <code>node-js-crash-course</code> folder with your IDE, and open the file <code>src/routes/checkin_routes.js</code>. Locate the function that handles the <code>/checkins/latest</code> route.</p><p>Using the <a href="https://redis.io/commands/xrevrange" target="_blank" rel="noopener noreferrer">XREVRANGE documentation</a> as a guide, modify the following line to invoke <code>XREVRANGE</code> so that it returns just the most recent checkin:</p><div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> latestCheckin </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="font-style:italic">await</span><span class="token plain"> redisClient</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">xrevrange</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">checkinStreamKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;TODO&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Remember: When using ioredis, each parameter to a Redis command needs to be passed as a separate value.</p><p>Test your code by visiting <code>http://localhost:8081/checkins/latest</code> - you should see a JSON representation of a checkin.</p><p>To make sure your code returns the latest checkin, you need to POST a checking using Postman. Start the Checkin Receiver component in a new terminal window:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">npm</span><span class="token plain"> run checkinreceiver</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then use Postman to POST a checkin. In Postman, open a new request, configure it as shown, and press Send:</p><p><img loading="lazy" alt="Checkin Test with Postman" src="/assets/images/xrevrange_checkin_test-9fe2bf778325b6206fda2d40c2666daa.png" width="1854" height="652" class="img_ev3q"></p><p>Now when you refresh <code>http://localhost:8081/checkins/latest</code> in your browser, the values shown should match those that you supplied in Postman.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="external-resources">External Resources<a class="hash-link" href="#external-resources" title="Direct link to heading">​</a></h2><ul><li><a href="https://university.redis.com/courses/ru202/" target="_blank" rel="noopener noreferrer">RU202, Redis Streams</a> at Redis University provides a deep dive into Redis Streams.</li><li><a href="https://redis.io/topics/streams-intro" target="_blank" rel="noopener noreferrer">Introduction to Redis Streams</a> at redis.io.</li></ul><p>In this video, Justin introduces Redis Streams with an example application that&#x27;s very similar to the one we&#x27;re building in this course:</p><div class="text--center"><iframe width="896" height="509" src="https://www.youtube.com/embed/7cvyluza00Q" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></div><p>In our example application, we process stream entries in Node.js using the array representation that ioredis returns by default. In this video, I look at using advanced features of ioredis to make it return JavaScript objects instead:</p><div class="text--center"><iframe width="896" height="509" src="https://www.youtube.com/embed/dukkMLbzPfA" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"></iframe></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/threetenlabs/threetenlabs/edit/master/docs/company/node/node-crash-course/checkinswithstreams/index-checkinswithstreams.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-11-19T03:08:10.000Z">Nov 19, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#hands-on-exercise" class="table-of-contents__link toc-highlight">Hands-on exercise</a></li><li><a href="#coding-exercise" class="table-of-contents__link toc-highlight">Coding exercise</a></li><li><a href="#external-resources" class="table-of-contents__link toc-highlight">External Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row"><div class="col col--3"><div class="footer__logo-ctr"><span class="footer__logo-tagline">Made with ❤️ by</span><a href="https://threetenlabs.com/" target="_blank" rel="noopener" class="footerLogoLink_fGS1"><img loading="lazy" class="footer__logo" alt="ThreeTen Labs logo" src="/img/logo-1.png"></a></div></div><div class="col col--9"><div class="row footer__links"><div class="col col--4 footer__col"><h4 class="footer__title">Get Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/games/">Games</a></li><li class="footer__item"><a class="footer__link-item" href="/company/">Company</a></li></ul></div><div class="col col--4 footer__col"><h4 class="footer__title">Mobile Applications</h4><ul class="footer__items"><li class="footer__item"><a href="https://play.google.com/store/games?hl=en_US&amp;gl=US" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Play Store</a></li><li class="footer__item"><a href="https://www.google.com/aclk?sa=l&amp;ai=DChcSEwjti6-lsLCCAxVTREcBHePWD5UYABABGgJxdQ&amp;ase=2&amp;gclid=Cj0KCQiAuqKqBhDxARIsAFZELmIsqZLsX5VUBTnZyroBKqNkekxkFjml_1kkrf095qdhZ3VJh2ZM1I8aAhz7EALw_wcB&amp;sig=AOD64_0a_wlOYm72NTLP9hTCfjLUMjQXWQ&amp;q&amp;nis=4&amp;adurl&amp;ved=2ahUKEwjynKWlsLCCAxVSkIkEHZRICMsQ0Qx6BAgGEAE" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apple Store</a></li></ul></div></div></div></div><div class="footer__copyright">Copyright: © 2023 ThreeTen Labs. All rights reserved. ThreeTen Labs and the cube logo are registered trademarks of ThreeTen Labs LLC</div></div></footer></div>
<script src="/assets/js/runtime~main.2d5a4e7a.js"></script>
<script src="/assets/js/main.26486879.js"></script>
</body>
</html>