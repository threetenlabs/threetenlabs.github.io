<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-support/redis-at-scale/scalability/exercise-1/index-exercise-1">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">4.1 Exercise - Creating a Redis Cluster | The Home of ThreeTen Labs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://threetenlabs.com/img/redis-hero-image.jpg"><meta data-rh="true" name="twitter:image" content="https://threetenlabs.com/img/redis-hero-image.jpg"><meta data-rh="true" property="og:url" content="https://threetenlabs.com/operate/redis-at-scale/scalability/exercise-1"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="4.1 Exercise - Creating a Redis Cluster | The Home of ThreeTen Labs"><meta data-rh="true" name="description" content="Step 1"><meta data-rh="true" property="og:description" content="Step 1"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://threetenlabs.com/operate/redis-at-scale/scalability/exercise-1"><link data-rh="true" rel="alternate" href="https://threetenlabs.com/operate/redis-at-scale/scalability/exercise-1" hreflang="en"><link data-rh="true" rel="alternate" href="https://threetenlabs.com/operate/redis-at-scale/scalability/exercise-1" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.e699af7e.css">
<link rel="preload" href="/assets/js/runtime~main.107a44d4.js" as="script">
<link rel="preload" href="/assets/js/main.1684004e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:rgb(210, 215, 254);color:rgb(22 31 49)" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><div class="announcement-bar"><a href="https://google.com" target="_blank" rel="noopener"><span>Announcing the first release of Spider Solitaire</span> <span style="margin-left:1rem">Learn more</span> <span style="margin-left:0.25rem">→</span></a></div></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--dark"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo-1.png" alt="ThreeTen Labs logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-1.png" alt="ThreeTen Labs logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><div id="redis-sitesearch" class="redis-sitesearch redis-sitesearch-inline"><input class="redis-sitesearch-input"><div class="redis-sitesearch-result-list-wrapper"><ul class="redis-sitesearch-result-list"></ul><div class="redisearch-logo"></div></div></div></div><a class="navbar__item navbar__link" href="/games/">Games</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo-1.png" alt="ThreeTen Labs logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo-1.png" alt="ThreeTen Labs logo" class="themedImage_ToTc themedImage--dark_i4oU"></a><nav class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">Home</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/games">Games</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/company">Company</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/operate/observability/redisdatasource">Support</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/observability/redisdatasource">Observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/provisioning/terraform">Provisioning</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/operate/redis-at-scale">Running Redis at Scale</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/operate/redis-at-scale">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/redis-at-scale/talking-to-redis/redis-server-overview">1 Talking to Redis</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/redis-at-scale/persistence-and-durability/introduction">2 Persistence &amp; Durability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/redis-at-scale/high-availability/introduction">3 High Availability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/operate/redis-at-scale/scalability/lustering-in-redis">4 Scalability</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/operate/redis-at-scale/scalability/lustering-in-redis">4.0 Clustering In Redis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/operate/redis-at-scale/scalability/exercise-1">4.1 Exercise - Creating a Redis Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/operate/redis-at-scale/scalability/redis-cli-with-redis-cluster">4.2 Using Redis-CLI with a Redis Cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/operate/redis-at-scale/scalability/redis-cluster-and-client-libraries">4.3 Redis Cluster and Client Libraries</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/redis-at-scale/observability/introduction">5 Observability</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/operate/redis-at-scale/course-wrap-up/">6 Course wrap-up</a></div></li></ul></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Support</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Running Redis at Scale</span><meta itemprop="position" content="2"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">4 Scalability</span><meta itemprop="position" content="3"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">4.1 Exercise - Creating a Redis Cluster</span><meta itemprop="position" content="4"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>4.1 Exercise - Creating a Redis Cluster</h1></header><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-1">Step 1<a class="hash-link" href="#step-1" title="Direct link to heading">​</a></h2><p>To create a cluster, we need to spin up a few empty Redis instances and configure them to run in cluster mode.</p><p>Here’s a minimal configuration file for Redis Cluster:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># redis.conf file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">port </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cluster-enabled </span><span class="token function" style="color:rgb(130, 170, 255)">yes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cluster-config-file nodes.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cluster-node-timeout </span><span class="token number" style="color:rgb(247, 140, 108)">5000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">appendonly </span><span class="token function" style="color:rgb(130, 170, 255)">yes</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>On the first line we specify the port on which the server should run, then we state that we want the server to run in cluster mode, with the <code>cluster-enabled yes</code> directive. <code>cluster-config-file</code> defines the name of the file where the configuration for this node is stored, in case of a server restart. Finally, <code>cluster-node-timeout</code> is the number of milliseconds a node must be unreachable for it to be considered in failure state.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-2">Step 2<a class="hash-link" href="#step-2" title="Direct link to heading">​</a></h2><p>Let’s create a cluster on your localhost with three primary shards and three replicas (remember, in production always use two replicas to protect against a split-brain situation). We’ll need to bring up six Redis processes and create a <code>redis.conf</code> file for each of them, specifying their port and the rest of the configuration directives above.</p><p>First, create six directories:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> -p </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token number" style="color:rgb(247, 140, 108)">7005</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-3">Step 3<a class="hash-link" href="#step-3" title="Direct link to heading">​</a></h2><p>Then create the minimal configuration <code>redis.conf</code> file from above in each one of them, <strong>making sure you change the port directive to match the directory name</strong>.</p><p>To copy the initial <code>redis.conf</code> file to each folder, run the following:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:rgb(191, 199, 213)">i</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token number" style="color:rgb(247, 140, 108)">7005</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> redis.conf </span><span class="token variable" style="color:rgb(191, 199, 213)">$i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You should end up with the following directory structure:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">- </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- </span><span class="token number" style="color:rgb(247, 140, 108)">7001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- </span><span class="token number" style="color:rgb(247, 140, 108)">7002</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- </span><span class="token number" style="color:rgb(247, 140, 108)">7003</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- </span><span class="token number" style="color:rgb(247, 140, 108)">7004</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">- </span><span class="token number" style="color:rgb(247, 140, 108)">7005</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  - redis.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-4">Step 4<a class="hash-link" href="#step-4" title="Direct link to heading">​</a></h2><p>Open six terminal tabs and start the servers by going into each one of the directories and starting a Redis instance:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Terminal tab 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/path/to/redis-server ./redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Terminal tab 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7001</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/path/to/redis-server ./redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. and so on.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-5">Step 5<a class="hash-link" href="#step-5" title="Direct link to heading">​</a></h2><p>Now that you have six empty Redis servers running, you can join them in a cluster:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">redis-cli --cluster create </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7001 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7002 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7003 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7004 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7005 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--cluster-replicas </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we list the ports and IP addresses of all six servers and use the <code>create</code> command to instruct Redis to join them in a cluster, creating one replica for each primary. <code>redis-cli</code> will propose a configuration; accept it by typing yes. The cluster will be configured and joined, which means, instances will be bootstrapped into talking with each other.</p><p>Finally, you should see a message saying:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> All </span><span class="token number" style="color:rgb(247, 140, 108)">16384</span><span class="token plain"> slots covered</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This means that there is at least a master instance serving each of the 16384 slots available.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-6">Step 6<a class="hash-link" href="#step-6" title="Direct link to heading">​</a></h2><p>Let’s add a new shard to the cluster, which is something you might do when you need to scale.</p><p>First, as before, we need to start two new empty Redis instances (primary and its replica) in cluster mode. We create new directories <code>7006</code> and <code>7007</code> and in them we copy the same <code>redis.conf</code> file we used before, making sure we change the port directive in them to the appropriate port (<code>7006</code> and <code>7007</code>).</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7006</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain">/redis.conf </span><span class="token number" style="color:rgb(247, 140, 108)">7006</span><span class="token plain">/redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token function" style="color:rgb(130, 170, 255)">cp</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain">/redis.conf </span><span class="token number" style="color:rgb(247, 140, 108)">7007</span><span class="token plain">/redis.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Update the port numbers in the files <code>./7006/redis.conf</code> and <code>./7007/redis.conf</code> to <code>7006</code> and <code>7007</code>, respectively.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-7">Step 7<a class="hash-link" href="#step-7" title="Direct link to heading">​</a></h2><p>Let’s start the Redis instances:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Terminal tab 7</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7006</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-server ./redis.conf</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># Terminal tab 8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">cd</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7007</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-server ./redis.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-8">Step 8<a class="hash-link" href="#step-8" title="Direct link to heading">​</a></h2><p>In the next step we join the new primary shard to the cluster with the <code>add-node</code> command. The first parameter is the address of the new shard, and the second parameter is the address of any of the current shards in the cluster.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">redis-cli --cluster add-node </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7006 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The Redis commands use the term “Nodes” for what we call “Shards” in this training, so a command named “add-node” would mean “add a shard”.</p></div></div><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-9">Step 9<a class="hash-link" href="#step-9" title="Direct link to heading">​</a></h2><p>Finally we need to join the new replica shard, with the same <code>add-node</code> command, and a few extra arguments indicating the shard is joining as a replica and what will be its primary shard. If we don’t specify a primary shard Redis will assign one itself.</p><p>We can find the IDs of our shards by running the cluster nodes command on any of the shards:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-cli -p </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"> cluster nodes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">46a768cfeadb9d2aee91ddd882433a1798f53271 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7006@17006 master - </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754504000</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> connected</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1f2bc068c7ccc9e408161bd51b695a9a47b890b2 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7003@17003 slave a138f48fe038b93ea2e186e7a5962fb1fa6e34fa </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754504551</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> connected</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5b4e4be56158cf6103ffa3035024a8d820337973 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7001@17001 master - </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754505584</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> connected </span><span class="token number" style="color:rgb(247, 140, 108)">5461</span><span class="token plain">-10922</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a138f48fe038b93ea2e186e7a5962fb1fa6e34fa </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7002@17002 master - </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754505000</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> connected </span><span class="token number" style="color:rgb(247, 140, 108)">10923</span><span class="token plain">-16383</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">71e078dab649166dcbbcec51520742bc7a5c1992 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7005@17005 slave 5b4e4be56158cf6103ffa3035024a8d820337973 </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754505584</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> connected</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">f224ecabedf39d1fffb34fb6c1683f8252f3b7dc </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000@17000 myself,master - </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754502000</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> connected </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">-5460</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">04d71d5eb200353713da475c5c4f0a4253295aa4 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7004@17004 slave f224ecabedf39d1fffb34fb6c1683f8252f3b7dc </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1616754505896</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> connected</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The port of the primary shard we added in the last step was <code>7006</code>, and we can see it on the first line. It’s id is <code>46a768cfeadb9d2aee91ddd882433a1798f53271</code>.</p><p>The resulting command is:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-cli -p </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"> --cluster add-node </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7007 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000 --cluster-slave --cluster-master-id 46a768cfeadb9d2aee91ddd882433a1798f53271</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The flag <code>cluster-slave</code> indicates that the shard should join as a replica and <code>--cluster-master-id 46a768cfeadb9d2aee91ddd882433a1798f53271</code> specifies which primary shard it should replicate.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="step-10">Step 10<a class="hash-link" href="#step-10" title="Direct link to heading">​</a></h2><p>Now our cluster has eight shards (four primary and four replica), but if we run the cluster slots command we’ll see that the newly added shards don’t host any hash slots, and thus - data. Let’s assign some hash slots to them:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-cli  -p </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain">  --cluster reshard </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We use the command <code>reshard</code> and the address of any shard in the cluster as an argument here. In the next step we’ll be able to choose the shards we’ll be moving slots from and to.</p><p>The first question you’ll get is about the number of slots you want to move. If we have 16384 slots in total, and four primary shards, let’s get a quarter of all shards, so the data is distributed equally. 16384 ÷ 4 is 4096, so let’s use that number.</p><p>The next question is about the receiving shard id; the ID of the primary shard we want to move the data to, which we learned how to get in the previous Step, with the cluster nodes command.</p><p>Finally, we need to enter the IDs of the shards we want to copy data from. Alternatively, we can type “all” and the shard will move a number of hash slots from all available primary shards.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-cli -p </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"> --cluster reshard </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">How many slots </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> you want to move </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">from </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> to </span><span class="token number" style="color:rgb(247, 140, 108)">16384</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">? </span><span class="token number" style="color:rgb(247, 140, 108)">4096</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">What is the receiving </span><span class="token function" style="color:rgb(130, 170, 255)">node</span><span class="token plain"> ID? 46a768cfeadb9d2aee91ddd882433a1798f53271</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Please enter all the </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">node</span><span class="token plain"> IDs.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;all&#x27;</span><span class="token plain"> to use all the nodes as </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> nodes </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> the </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">hash</span><span class="token plain"> slots.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Type </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;done&#x27;</span><span class="token plain"> once you entered all the </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">source</span><span class="token plain"> nodes IDs.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Source </span><span class="token function" style="color:rgb(130, 170, 255)">node</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#1: all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Ready to move </span><span class="token number" style="color:rgb(247, 140, 108)">4096</span><span class="token plain"> slots.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Source nodes:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    M: f224ecabedf39d1fffb34fb6c1683f8252f3b7dc </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slots:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">-5460</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5461</span><span class="token plain"> slots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> additional replica</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    M: 5b4e4be56158cf6103ffa3035024a8d820337973 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7001</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slots:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">5461</span><span class="token plain">-10922</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5462</span><span class="token plain"> slots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> additional replica</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    M: a138f48fe038b93ea2e186e7a5962fb1fa6e34fa </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7002</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slots:</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">10923</span><span class="token plain">-16383</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5461</span><span class="token plain"> slots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> additional replica</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Destination node:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    M: 46a768cfeadb9d2aee91ddd882433a1798f53271 </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7006</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    slots: </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> slots</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> additional replica</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Resharding plan:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Moving slot </span><span class="token number" style="color:rgb(247, 140, 108)">5461</span><span class="token plain"> from 5b4e4be56158cf6103ffa3035024a8d820337973</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Moving slot </span><span class="token number" style="color:rgb(247, 140, 108)">5462</span><span class="token plain"> from 5b4e4be56158cf6103ffa3035024a8d820337973</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Do you want to proceed with the proposed reshard plan </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">yes/no</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Moving slot </span><span class="token number" style="color:rgb(247, 140, 108)">5461</span><span class="token plain"> from </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7001 to </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7006:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Moving slot </span><span class="token number" style="color:rgb(247, 140, 108)">5462</span><span class="token plain"> from </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7001 to </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7006:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Moving slot </span><span class="token number" style="color:rgb(247, 140, 108)">5463</span><span class="token plain"> from </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7001 to </span><span class="token number" style="color:rgb(247, 140, 108)">127.0</span><span class="token plain">.0.1:7006:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the command finishes we can run the cluster slots command again and we’ll see that our new primary and replica shards have been assigned some hash slots:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ redis-cli -p </span><span class="token number" style="color:rgb(247, 140, 108)">7000</span><span class="token plain"> cluster slots</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-11-08T16:00:40.000Z">Nov 8, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/operate/redis-at-scale/scalability/lustering-in-redis"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">4.0 Clustering In Redis</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/operate/redis-at-scale/scalability/redis-cli-with-redis-cluster"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">4.2 Using Redis-CLI with a Redis Cluster</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#step-1" class="table-of-contents__link toc-highlight">Step 1</a></li><li><a href="#step-2" class="table-of-contents__link toc-highlight">Step 2</a></li><li><a href="#step-3" class="table-of-contents__link toc-highlight">Step 3</a></li><li><a href="#step-4" class="table-of-contents__link toc-highlight">Step 4</a></li><li><a href="#step-5" class="table-of-contents__link toc-highlight">Step 5</a></li><li><a href="#step-6" class="table-of-contents__link toc-highlight">Step 6</a></li><li><a href="#step-7" class="table-of-contents__link toc-highlight">Step 7</a></li><li><a href="#step-8" class="table-of-contents__link toc-highlight">Step 8</a></li><li><a href="#step-9" class="table-of-contents__link toc-highlight">Step 9</a></li><li><a href="#step-10" class="table-of-contents__link toc-highlight">Step 10</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row"><div class="col col--3"><div class="footer__logo-ctr"><span class="footer__logo-tagline">Made with ❤️ by</span><a href="https://threetenlabs.com/" target="_blank" rel="noopener" class="footerLogoLink_fGS1"><img loading="lazy" class="footer__logo" alt="ThreeTen Labs logo" src="/img/logo-1.png"></a></div></div><div class="col col--9"><div class="row footer__links"><div class="col col--4 footer__col"><h4 class="footer__title">Get Started</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/games/">Games</a></li><li class="footer__item"><a class="footer__link-item" href="/company/">Company</a></li></ul></div><div class="col col--4 footer__col"><h4 class="footer__title">Mobile Applications</h4><ul class="footer__items"><li class="footer__item"><a href="https://play.google.com/store/games?hl=en_US&amp;gl=US" target="_blank" rel="noopener noreferrer" class="footer__link-item">Google Play Store</a></li><li class="footer__item"><a href="https://www.google.com/aclk?sa=l&amp;ai=DChcSEwjti6-lsLCCAxVTREcBHePWD5UYABABGgJxdQ&amp;ase=2&amp;gclid=Cj0KCQiAuqKqBhDxARIsAFZELmIsqZLsX5VUBTnZyroBKqNkekxkFjml_1kkrf095qdhZ3VJh2ZM1I8aAhz7EALw_wcB&amp;sig=AOD64_0a_wlOYm72NTLP9hTCfjLUMjQXWQ&amp;q&amp;nis=4&amp;adurl&amp;ved=2ahUKEwjynKWlsLCCAxVSkIkEHZRICMsQ0Qx6BAgGEAE" target="_blank" rel="noopener noreferrer" class="footer__link-item">Apple Store</a></li></ul></div></div></div></div><div class="footer__copyright">Copyright: © 2023 ThreeTen Labs. All rights reserved. ThreeTen Labs and the cube logo are registered trademarks of ThreeTen Labs LLC</div></div></footer></div>
<script src="/assets/js/runtime~main.107a44d4.js"></script>
<script src="/assets/js/main.1684004e.js"></script>
</body>
</html>