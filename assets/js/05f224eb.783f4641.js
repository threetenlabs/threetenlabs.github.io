"use strict";(self.webpackChunkthreeten_labs_site=self.webpackChunkthreeten_labs_site||[]).push([[6635],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,l=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),u=c(n),p=r,m=u["".concat(l,".").concat(p)]||u[p]||h[p]||s;return n?a.createElement(m,i(i({ref:t},d),{},{components:n})):a.createElement(m,i({ref:t},d))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,i=new Array(s);i[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:r,i[1]=o;for(var c=2;c<s;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},236:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const s={id:"index-redisearch",title:"Indexing and Querying with Redis",sidebar_label:"Searching and Querying",slug:"/develop/node/nodecrashcourse/redisearch",authors:["simon"]},i=void 0,o={unversionedId:"company/node/node-crash-course/redisearch/index-redisearch",id:"company/node/node-crash-course/redisearch/index-redisearch",title:"Indexing and Querying with Redis",description:"<iframe",source:"@site/docs/company/node/node-crash-course/redisearch/index-redisearch.mdx",sourceDirName:"company/node/node-crash-course/redisearch",slug:"/develop/node/nodecrashcourse/redisearch",permalink:"/develop/node/nodecrashcourse/redisearch",draft:!1,editUrl:"https://github.com/threetenlabs/threetenlabs/edit/master/docs/company/node/node-crash-course/redisearch/index-redisearch.mdx",tags:[],version:"current",lastUpdatedAt:1699459240,formattedLastUpdatedAt:"Nov 8, 2023",frontMatter:{id:"index-redisearch",title:"Indexing and Querying with Redis",sidebar_label:"Searching and Querying",slug:"/develop/node/nodecrashcourse/redisearch",authors:["simon"]},sidebar:"docs",previous:{title:"JSON",permalink:"/develop/node/nodecrashcourse/redisjson"},next:{title:"Checkins with Streams",permalink:"/develop/node/nodecrashcourse/checkinswithstreams"}},l={},c=[{value:"Coding Exercise",id:"coding-exercise",level:2},{value:"External Resources",id:"external-resources",level:2}],d={toc:c},u="wrapper";function h(e){let{components:t,...s}=e;return(0,r.kt)(u,(0,a.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("div",{class:"text--center"},(0,r.kt)("iframe",{width:"896",height:"509",src:"https://www.youtube.com/embed/HPvP_OJ7h2Q",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,r.kt)("p",null,"We chose to store our user and location data in Redis Hashes. Hashes are a great fit for storing domain objects. Recall that we've chosen to store each user in a Hash whose key contains the user ID. For example, here's user 852 as seen in RedisInsight:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"User 852 viewed with RedisInsight",src:n(8794).Z,width:"1363",height:"824"})),(0,r.kt)("p",null,"If you're using redis-cli, you can look at user 852 with the ",(0,r.kt)("inlineCode",{parentName:"p"},"HGETALL")," command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'127.0.0.1:6379> hgetall ncc:users:852\n 1) "id"\n 2) "852"\n 3) "firstName"\n 4) "Dominik"\n 5) "lastName"\n 6) "Schiffmann"\n 7) "email"\n 8) "dominik.schiffmann@example.com"\n 9) "password"\n10) "$2b$05$xbkSwODz1tWqdE7xWb393eiYIQcdiEdbbvhK88.Xr9sW7WxdI26qi"\n11) "numCheckins"\n12) "9353"\n13) "lastCheckin"\n14) "1488517098363"\n15) "lastSeenAt"\n16) "124"\n')),(0,r.kt)("p",null,"Storing data in Hashes means that we can easily and efficiently retrieve the contents of the Hash, provided that we know the key. So it's trivial to look up user 852, but how can we perform any of the following operations?"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Get the user whose email address is ",(0,r.kt)("inlineCode",{parentName:"li"},"dominik.schiffmann@example.com"),"."),(0,r.kt)("li",{parentName:"ul"},"Find all users that were last seen at location 124."),(0,r.kt)("li",{parentName:"ul"},"Find all the users who have between 1000 and 3000 checkins."),(0,r.kt)("li",{parentName:"ul"},"Find all locations within a 10 mile radius of a given latitude / longitude coordinate and which have at least a 3 star rating.")),(0,r.kt)("p",null,"Redis is a key/value database. This means that its data model is optimized for retrieval by key. The queries above can't be resolved by knowing just the Hash key - we need some other mechanism to index our data."),(0,r.kt)("p",null,'Traditionally in a key/value database, this has meant adding code to create and manually update indexes. For example to resolve the query "which user has the email address ',(0,r.kt)("inlineCode",{parentName:"p"},"dominik.schiffmann@example.com"),"\", we might create a new String key containing that email address, with the value being the user's ID:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"127.0.0.1:6379> set ncc:users:byemail:dominik.schiffmann@example.com 852\nOK\n")),(0,r.kt)("p",null,"Now, if we want to get Dominik's user details given only his email address, we have a two step process to follow:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Look up the user ID for the user associated with the email address we have."),(0,r.kt)("li",{parentName:"ol"},"Use that user ID to retrieve the values from the user's Hash.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'127.0.0.1:6379> get ncc:users:byemail:dominik.schiffmann@example.com\n"852"\n127.0.0.1:6379> hgetall ncc:users:852\n 1) "id"\n 2) "852"\n 3) "firstName"\n 4) "Dominik"\n 5) "lastName"\n 6) "Schiffmann"\n 7) "email"\n 8) "dominik.schiffmann@example.com"\n 9) "password"\n10) "$2b$05$xbkSwODz1tWqdE7xWb393eiYIQcdiEdbbvhK88.Xr9sW7WxdI26qi"\n11) "numCheckins"\n12) "9353"\n13) "lastCheckin"\n14) "1488517098363"\n15) "lastSeenAt"\n16) "124"\n')),(0,r.kt)("p",null,"We'd also need to keep this information up to date and in sync with changes to the Hash at ",(0,r.kt)("inlineCode",{parentName:"p"},"ncc:users:852")," ourselves in our application code."),(0,r.kt)("p",null,"Other sorts of secondary indexes can be created using other Redis data types. For example, we might ",(0,r.kt)("a",{parentName:"p",href:"https://redis.io/topics/indexes"},"use a Redis Sorted Set as a secondary index"),', allowing us to perform range queries such as "Find all the users who have between 1000 and 3000 checkins". Again, we\'d have to populate and maintain this extra data structure ourselves in the application code.'),(0,r.kt)("p",null,'Redis Stack solves all of these problems for us and more. It adds an indexing, querying and full-text search engine to Redis that automatically keeps track of changes to data in indexed Hashes. Redis Stack provides a flexible query language to answer questions such as "Find me all the gyms with at least a 3 star rating and more than 200 checkins within 10 miles of Oakland, California" without adding code to build or maintain secondary data structures in our application.'),(0,r.kt)("p",null,"Watch the video to see how Redis Stack is used in our example Node.js application."),(0,r.kt)("h2",{id:"coding-exercise"},"Coding Exercise"),(0,r.kt)("p",null,"In this exercise, you'll finish implementing a route that uses Redis to return all users whose last checkin was at a given location."),(0,r.kt)("p",null,"Open the ",(0,r.kt)("inlineCode",{parentName:"p"},"node-js-crash-course")," folder with your IDE, and find the file ",(0,r.kt)("inlineCode",{parentName:"p"},"src/routes/user_routes.js"),"."),(0,r.kt)("p",null,"In this file, you'll see a partly implemented route ",(0,r.kt)("inlineCode",{parentName:"p"},"/users/at/:locationId"),". To complete this exercise, you'll need to replace this line:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const searchResults = await redis.performSearch(\n  redis.getKeyName('usersidx'),\n  'TODO... YOUR QUERY HERE',\n);\n")),(0,r.kt)("p",null,'with one containing the correct query to return users whose "lastSeenAt" field is set to the value of locationId. You\'ll need to use the "numeric range" syntax for this, as the "lastSeenAt" field was indexed as a number. Be sure to check out the ',(0,r.kt)("a",{parentName:"p",href:"https://redis.io/docs/stack/search/reference/query_syntax/"},"Query Syntax documentation")," for Redis to get help with this."),(0,r.kt)("p",null,"To try your code, ensure that the API Server component is running:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"$ npm run dev\n")),(0,r.kt)("p",null,"(remember, this will use nodemon to restart the server any time you save a code change)."),(0,r.kt)("p",null,"Then, point your browser at ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:8081/api/users/at/33"),". If your query is correct, you should see output similar to the following (actual users may differ, just ensure that the value of ",(0,r.kt)("inlineCode",{parentName:"p"},"lastSeenAt")," for each matches the location ID you provided - 33 in this case):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "id": "238",\n    "firstName": "Jonas",\n    "lastName": "Nielsen",\n    "numCheckins": "7149",\n    "lastCheckin": "1515248028256",\n    "lastSeenAt": "33"\n  },\n  {\n    "id": "324",\n    "firstName": "Frans",\n    "lastName": "Potze",\n    "numCheckins": "8623",\n    "lastCheckin": "1515976232073",\n    "lastSeenAt": "33"\n  },\n  ...\n]\n')),(0,r.kt)("p",null,"To help you develop your query, use one of the guides in RedisInsight workbench, or read more about the ",(0,r.kt)("a",{parentName:"p",href:"https://redis.io/commands/ft.search/"},"FT.SEARCH command"),"."),(0,r.kt)("h2",{id:"external-resources"},"External Resources"),(0,r.kt)("p",null,"Querying, Index, and Full-Text Search in Redis:"),(0,r.kt)("div",{class:"text--center"},(0,r.kt)("iframe",{width:"896",height:"509",src:"https://www.youtube.com/embed/B10nHEdW3NA",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,r.kt)("p",null,"Finding Bigfoot RESTfuly with Express + Redis Stack:"),(0,r.kt)("div",{class:"text--center"},(0,r.kt)("iframe",{width:"896",height:"509",src:"https://www.youtube.com/embed/eJFwsNfi_MI",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0})),(0,r.kt)("p",null,"Other resources:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://university.redis.com/courses/ru203/"},"RU203, Querying, Indexing, and Full-Text Search")," at Redis University"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://redis.io/docs/stack/search/"},"Official Redis Stack docs for search"))))}h.isMDXComponent=!0},8794:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/insight_user_852-a8c42050d96696573fac10e960edb705.png"}}]);